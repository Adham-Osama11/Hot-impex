<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4K UHD Generator - HOT IMPEX</title>

    <link rel="stylesheet" href="assets/css/navbar.css">
    <!-- Product Detail Script -->
    <script src="assets/js/modules/product-detail.js" defer></script>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css/index.css">
    <link rel="stylesheet" href="assets/css/product.css">
    <!-- Theme initialization script - must run before body content -->
    <script>
        // Check for saved dark mode preference and apply immediately
        const isDarkMode = localStorage.getItem('darkMode') === 'true';
        if (isDarkMode) {
            document.documentElement.classList.add('dark');
        } else {
            // Ensure light mode is properly applied
            document.documentElement.classList.remove('dark');
        }
    </script>
</head>
<body class="product-page">
    <!-- Navigation Bar -->
    <header class="nav-header">
        <div class="nav-container">
            <nav class="nav-flex">
                <!-- Mobile Menu Toggle Button (Left side on mobile) -->
                <button id="mobile-menu-toggle" class="mobile-menu-toggle">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>

                <!-- Invisible spacer for mobile balance -->
                <div class="mobile-spacer"></div>

                <!-- Main Navigation Section (Centered) -->
                <div id="main-nav" class="main-nav">
                    <div class="nav-content">
                        <a href="index.html" class="nav-link">Home</a>
                        <a href="shop.html" class="nav-link">Products</a>
                        <a href="contact.html" class="nav-link">Contact Us</a>
                        <a href="about.html" class="nav-link">About Us</a>
                        
                        <!-- Dark Mode Toggle -->
                        <div class="theme-toggle-container">
                            <div id="theme-toggle" class="theme-toggle" title="Toggle Dark Mode">
                                <svg class="sun-icon" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path>
                                </svg>
                                <svg class="moon-icon" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
                                </svg>
                            </div>
                        </div>
                        
                        <!-- User Icon with Dropdown -->
                        <div class="user-dropdown-wrapper">
                            <div id="user-dropdown-toggle" class="user-dropdown-toggle">
                                <!-- Simple SVG for user icon -->
                                <svg class="user-icon" viewBox="0 0 24 24" fill="#374151">
                                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                                </svg>
                                <span id="user-display-name" class="user-display-name">Account</span>
                                <!-- Dropdown Arrow -->
                                <svg class="user-dropdown-arrow" id="user-dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                            
                            <!-- User Dropdown Menu -->
                            <div id="user-dropdown-menu" class="user-dropdown-menu hidden">
                                <!-- Not Logged In State -->
                                <div id="user-not-logged-in" class="user-not-logged-in">
                                    <p>Sign in to access your account</p>
                                    <div class="btn-group">
                                        <button id="show-login-modal" class="btn-signin">
                                            Sign In
                                        </button>
                                        <button id="show-register-modal" class="btn-register">
                                            Create Account
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Logged In State (Hidden by default) -->
                                <div id="user-logged-in" class="user-logged-in">
                                    <div class="user-info">
                                        <p class="user-welcome" id="user-welcome">Welcome back!</p>
                                        <p class="user-email" id="user-email"></p>
                                    </div>
                                    <div class="user-menu">
                                        <a href="profile.html" id="user-profile-link" class="user-menu-link">
                                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                            </svg>
                                            Profile
                                        </a>
                                        <!-- Admin Panel Link (visible only for admin users) -->
                                        <a href="admin/admin.html" id="admin-panel-link" class="user-menu-link admin-panel-link hidden">
                                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                                            </svg>
                                            Admin Panel
                                        </a>
                                        <div class="menu-divider">
                                            <button id="logout-btn" class="btn-logout">
                                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                                </svg>
                                                Sign Out
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="mobile-menu-overlay hidden">
        <div class="mobile-menu-backdrop"></div>
        <div class="mobile-menu-panel">
            <div class="mobile-menu-content">
                <div class="mobile-menu-header">
                    <h2 class="mobile-menu-title">Menu</h2>
                    <button id="close-mobile-menu" class="mobile-menu-close">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <nav class="mobile-menu-nav">
                    <ul class="mobile-menu-list">
                        <li><a href="index.html" class="mobile-menu-link active">Home</a></li>
                        <li><a href="shop.html" class="mobile-menu-link">Products</a></li>
                        <li><a href="contact.html" class="mobile-menu-link">Contact Us</a></li>
                        <li><a href="about.html" class="mobile-menu-link">About Us</a></li>
                        <li>
                            <a href="profile.html" id="mobile-profile-link" class="mobile-menu-link">
                                <div class="mobile-menu-link-content">
                                    <svg class="mobile-menu-link-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                    <span>My Profile</span>
                                </div>
                            </a>
                        </li>
                        <!-- <li>
                            <a href="my-orders.html" id="mobile-orders-link" class="block py-3 px-4 rounded-lg hover:bg-white/25 hover:backdrop-blur-sm text-gray-800 dark:text-white transition-all duration-200 border border-white/20">
                                <div class="flex items-center space-x-3">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l-1 12H6L5 9z"></path>
                                    </svg>
                                    <span>My Orders</span>
                                </div>
                            </a>
                        </li> -->
                        <!-- <li>
                            <button id="mobile-cart-toggle" class="block w-full py-3 px-4 rounded-lg hover:bg-white/25 hover:backdrop-blur-sm text-gray-800 dark:text-white transition-all duration-200 border border-white/20 text-left">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                                            <path fill-rule="evenodd" d="M7.5 6v.75H5.513c-.96 0-1.763.746-1.858 1.705L2.26 19.99a2.25 2.25 0 002.24 2.51h15.002a2.25 2.25 0 002.24-2.51l-1.395-11.535A1.875 1.875 0 0018.488 6.75H16.5V6a4.5 4.5 0 10-9 0zM15 6.75V6a3 3 0 10-6 0v.75H15z" clip-rule="evenodd" />
                                        </svg>
                                        <span>Shopping Cart</span>
                                    </div>
                                    <span id="mobile-cart-badge" class="bg-orange-500 text-white text-xs font-semibold px-2 py-1 rounded-full" style="display: none;">0</span>
                                </div>
                            </button>
                        </li> -->
                        <li class="mobile-menu-divider">
                            <button id="mobile-login-btn" class="mobile-menu-button login" style="display: none;">
                                <div class="mobile-menu-button-content">
                                    <svg class="mobile-menu-button-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                                    </svg>
                                    <span>Sign In / Register</span>
                                </div>
                            </button>
                            <button id="mobile-logout-btn" class="mobile-menu-button logout" style="display: none;">
                                <div class="mobile-menu-button-content">
                                    <svg class="mobile-menu-button-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"></path>
                                    </svg>
                                    <span>Sign Out</span>
                                </div>
                            </button>
                        </li>
                    </ul>
                    <div class="mobile-menu-theme">
                        <div class="mobile-menu-theme-content">
                            <span class="mobile-menu-theme-label">Dark Mode</span>
                            <div id="mobile-theme-toggle" class="theme-toggle">
                                <svg class="sun-icon w-5 h-5 text-yellow-500 transition-opacity duration-300" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path>
                                </svg>
                                <svg class="moon-icon w-5 h-5 text-gray-400 transition-opacity duration-300 opacity-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="modal-overlay hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content-wrapper">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Sign In</h2>
                    <button id="close-login-modal" class="modal-close">
                        <svg class="modal-close-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <form id="login-form" class="modal-form">
                    <div class="modal-form-group">
                        <label for="login-email" class="modal-label">Email</label>
                        <input type="email" id="login-email" name="email" required 
                               class="modal-input"
                               placeholder="Enter your email">
                    </div>
                    
                    <div class="modal-form-group">
                        <label for="login-password" class="modal-label">Password</label>
                        <div class="modal-input-wrapper">
                            <input type="password" id="login-password" name="password" required 
                                   class="modal-input"
                                   placeholder="Enter your password">
                            <button type="button" id="toggle-login-password" class="modal-input-button">
                                <svg class="modal-input-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="modal-remember-forgot">
                        <label class="modal-checkbox-wrapper">
                            <input type="checkbox" class="modal-checkbox">
                            <span class="modal-checkbox-label">Remember me</span>
                        </label>
                        <a href="#" class="modal-link text-sm">Forgot password?</a>
                    </div>
                    
                    <button type="submit" class="modal-submit">
                        Sign In
                    </button>
                    
                    <div class="modal-footer">
                        <span class="modal-footer-text">Don't have an account? </span>
                        <button type="button" id="switch-to-register" class="modal-footer-button">
                            Create one
                        </button>
                    </div>
                </form>
                
                <div id="login-error" class="modal-message error hidden">
                    <p class="modal-message-text"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="register-modal" class="modal-overlay hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content-wrapper">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Create Account</h2>
                    <button id="close-register-modal" class="modal-close">
                        <svg class="modal-close-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <form id="register-form" class="modal-form">
                    <div class="modal-form-row">
                        <div class="modal-form-group">
                            <label for="register-firstName" class="modal-label">First Name</label>
                            <input type="text" id="register-firstName" name="firstName" required 
                                   class="modal-input"
                                   placeholder="First name">
                        </div>
                        <div class="modal-form-group">
                            <label for="register-lastName" class="modal-label">Last Name</label>
                            <input type="text" id="register-lastName" name="lastName" required 
                                   class="modal-input"
                                   placeholder="Last name">
                        </div>
                    </div>
                    
                    <div class="modal-form-group">
                        <label for="register-email" class="modal-label">Email</label>
                        <input type="email" id="register-email" name="email" required 
                               class="modal-input"
                               placeholder="Enter your email">
                    </div>
                    
                    <div class="modal-form-group">
                        <label for="register-phone" class="modal-label">Phone Number</label>
                        <input type="tel" id="register-phone" name="phone" 
                               class="modal-input"
                               placeholder="Enter your phone number">
                    </div>
                    
                    <div class="modal-form-group">
                        <label for="register-password" class="modal-label">Password</label>
                        <div class="modal-input-wrapper">
                            <input type="password" id="register-password" name="password" required 
                                   class="modal-input"
                                   placeholder="Create a password">
                            <button type="button" id="toggle-register-password" class="modal-input-button">
                                <svg class="modal-input-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                        <p class="modal-helper-text">Minimum 8 characters</p>
                    </div>
                    
                    <div class="modal-form-group">
                        <label class="modal-checkbox-wrapper">
                            <input type="checkbox" id="register-terms" required class="modal-checkbox">
                            <span class="modal-checkbox-label">
                                I agree to the <a href="#" class="modal-link">Terms of Service</a> 
                                and <a href="#" class="modal-link">Privacy Policy</a>
                            </span>
                        </label>
                    </div>
                    
                    <button type="submit" class="modal-submit">
                        Create Account
                    </button>
                    
                    <div class="modal-footer">
                        <span class="modal-footer-text">Already have an account? </span>
                        <button type="button" id="switch-to-login" class="modal-footer-button">
                            Sign in
                        </button>
                    </div>
                </form>
                
                <div id="register-error" class="modal-message error hidden">
                    <p class="modal-message-text"></p>
                </div>
                
                <div id="register-success" class="modal-message success hidden">
                    <p class="modal-message-text"></p>
                </div>
            </div>
        </div>
    </div>
    <!-- Cart Sidebar -->
    <!-- <div id="cart-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>
    <div id="cart-sidebar" class="fixed top-4 right-0 h-[calc(100vh-2rem)] w-[450px] bg-white/80 dark:bg-gray-900/80 backdrop-blur-lg shadow-2xl z-50 transform translate-x-full transition-transform duration-500 ease-in-out border border-white/20 rounded-l-2xl">
        <div class="flex flex-col h-full">
            <div class="flex items-center justify-between p-6 border-b border-gray-200/10 flex-shrink-0">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Shopping Cart</h2>
                <button id="close-cart" class="p-2 rounded-full text-gray-600 dark:text-gray-300 hover:bg-gray-200/50 dark:hover:bg-gray-700/50 transition-colors">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="flex-1 overflow-y-auto p-6 space-y-6">
                <div id="cart-items">
                    <div class="text-center text-gray-500 dark:text-gray-400 py-16">
                        <svg class="w-24 h-24 mx-auto text-gray-300 dark:text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                        <p class="mt-4 text-lg font-semibold">Your cart is empty</p>
                        <p class="mt-2 text-sm">Add items to see them here.</p>
                    </div>
                </div>
            </div>

            <div class="border-t border-gray-200/10 p-6 flex-shrink-0">
                <div class="flex items-center justify-between mb-4">
                    <span class="text-lg font-semibold text-gray-800 dark:text-white">Subtotal:</span>
                    <span id="cart-total" class="text-2xl font-bold text-purple-600 dark:text-purple-400">0 EGP</span>
                </div>
                <a href="checkout.html" class="block w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 px-6 rounded-xl hover:from-purple-700 hover:to-pink-700 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-purple-300 dark:focus:ring-purple-800 font-bold text-lg text-center">
                    Proceed to Checkout
                </a>
            </div>
        </div>
    </div> -->
    
    <!-- Breadcrumb -->
    <div class="product-breadcrumb">
        <nav class="product-breadcrumb-nav" aria-label="Breadcrumb">
            <ol class="product-breadcrumb-list">
                <li><a href="index.html" class="product-breadcrumb-link">Home</a></li>
                <li><span class="product-breadcrumb-separator">•</span></li>
                <li><a href="shop.html" class="product-breadcrumb-link">Products</a></li>
                <li><span class="product-breadcrumb-separator">•</span></li>
                <li><a href="#" id="breadcrumb-category" class="product-breadcrumb-link">Loading...</a></li>
                <li><span class="product-breadcrumb-separator">•</span></li>
                <li><span id="breadcrumb-product" class="product-breadcrumb-current">Loading...</span></li>
            </ol>
        </nav>
    </div>

    <!-- Main Product Content -->
    <div class="product-main-container">
        <div class="product-main-grid">
            <!-- Product Images - Larger section -->
            <div class="product-images-section">
                <!-- Main Product Image -->
                <div class="product-main-image-wrapper">
                    <div class="product-main-image-decoration-top"></div>
                    <div class="product-main-image-container">
                        <img id="main-image" src="" alt="Product Image" class="product-main-image">
                    </div>
                </div>
                
                <!-- Thumbnail Images -->
                <div id="product-thumbnails" class="product-thumbnails-grid">
                    <!-- Thumbnails will be dynamically loaded -->
                </div>
            </div>

            <!-- Product Details - Smaller section -->
            <div class="product-details-section">
                <!-- Product Title and Price -->
                <div class="product-header">
                    <span id="product-badge" class="product-badge product-badge-featured">Loading...</span>
                    <h1 id="product-title" class="product-title">Loading Product...</h1>
                    <!-- <div class="flex flex-col space-y-2 mb-4">
                        <span id="product-price" class="text-xl lg:text-2xl font-bold text-blue-600">EGP 0.00</span>
                        <div id="product-discount" class="flex items-center space-x-2 hidden">
                            <span id="original-price" class="text-sm text-gray-500 line-through"></span>
                            <span id="discount-badge" class="bg-red-100 text-red-800 text-xs font-semibold px-2 py-1 rounded-full"></span>
                        </div>
                    </div> -->
                    <!-- Main Action Buttons -->
                    <div class="product-actions">
                        <button id="datasheet-btn" class="product-btn-secondary">
                            <div class="absolute inset-0 bg-red-200 opacity-0 group-hover:opacity-60 transition-opacity duration-300"></div>
                            <div class="relative z-10 flex items-center justify-center space-x-2">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 384 512">
                                    <path d="M181.9 256.1c-5-16-4.9-46.9-2-46.9 8.4 0 7.6 36.9 2 46.9zm-1.7 47.2c-7.7 20.2-17.3 43.3-28.4 62.7 18.3-7 39-17.2 62.9-21.9-12.7-9.6-24.9-23.4-34.5-40.8zM86.1 428.1c0 .8 13.2-5.4 34.9-40.2-6.7 6.3-29.1 24.5-34.9 40.2zM248 160h136v328c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V24C0 10.7 10.7 0 24 0h200v136c0 13.2 10.8 24 24 24zm-8 171.8c-20-12.2-33.3-29-42.7-53.8 4.5-18.5 11.6-46.6 6.2-64.2-4.7-29.4-42.4-26.5-47.8-6.8-5 18.3-.4 44.1 8.1 77-11.6 27.6-28.7 64.6-40.8 85.8-.1 0-.1.1-.2.1-27.1 13.9-73.6 44.5-54.5 68 5.6 6.9 16 10 21.5 10 17.9 0 35.7-18 61.1-61.8 25.8-8.5 54.1-19.1 79-23.2 21.7 11.8 47.1 19.5 64 19.5 29.2 0 31.2-32 19.7-43.4-13.9-13.6-54.3-9.7-73.6-7.2zM377 105L279 7c-4.5-4.5-10.6-7-17-7h-6v128h128v-6c0-6.4-2.5-12.5-7-17z"/>
                                </svg>
                                <span>View Data Sheet</span>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Product Info Section -->
                <div class="product-info-section">
                    <!-- Product Description -->
                    
                    <div class="product-description-card">
                        <h3 class="product-description-title">
                            <svg class="product-description-icon" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                            </svg>
                            About This Product
                        </h3>
                        <p id="product-description" class="product-description-text">
                            Loading product description...
                        </p>
                    </div>
                </div>

                <!-- Key Features - Compact -->
                <div class="product-features-card">
                    <h3 class="product-features-title">
                        <svg class="product-features-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        Key Features
                    </h3>
                    <div id="product-features" class="product-features-grid">
                        <!-- Features will be dynamically loaded -->
                    </div>
                </div>

                <!-- Product Options - Compact -->
                <div class="space-y-4">
                    <!-- Pattern Type Selection -->
                    <!-- <div class="bg-white rounded-xl p-4 shadow-md border border-gray-200">
                        <h3 class="text-lg font-black text-gray-800 mb-4 flex items-center">
                            <div class="w-6 h-6 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-lg mr-2 flex items-center justify-center">
                                <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h4a1 1 0 010 2H6.414l2.293 2.293a1 1 0 01-1.414 1.414L5 6.414V8a1 1 0 01-2 0V4zm9 1a1 1 0 010-2h4a1 1 0 011 1v4a1 1 0 01-2 0V6.414l-2.293 2.293a1 1 0 11-1.414-1.414L13.586 5H12zm-9 7a1 1 0 012 0v1.586l2.293-2.293a1 1 0 111.414 1.414L6.414 15H8a1 1 0 010 2H4a1 1 0 01-1-1v-4zm13-1a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 010-2h1.586l-2.293-2.293a1 1 0 111.414-1.414L15 13.586V12a1 1 0 011-1z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            Test Pattern Package
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <button class="pattern-option group relative overflow-hidden px-4 py-3 border-2 border-purple-500 bg-gradient-to-br from-purple-50 to-pink-50 text-purple-700 rounded-xl text-center transition-all duration-300 transform hover:scale-105 shadow-sm" data-pattern="standard">
                                <div class="relative z-10">
                                    <div class="font-black text-base mb-1">Standard Package</div>
                                    <div class="text-xs text-purple-600 font-semibold">50+ Test Patterns</div>
                                    <div class="text-xs text-gray-600 mt-1">Essential patterns for basic calibration</div>
                                </div>
                                <div class="absolute inset-0 bg-gradient-to-r from-purple-600 to-pink-600 opacity-0 group-hover:opacity-10 transition-opacity duration-300"></div>
                            </button>
                            <button class="pattern-option group relative overflow-hidden px-4 py-3 border-2 border-gray-300 bg-white rounded-xl text-center hover:border-purple-500 hover:bg-gradient-to-br hover:from-purple-50 hover:to-pink-50 transition-all duration-300 transform hover:scale-105 shadow-sm" data-pattern="professional">
                                <div class="relative z-10">
                                    <div class="font-black text-base mb-1">Professional Package</div>
                                    <div class="text-xs text-gray-600 font-semibold group-hover:text-purple-600">100+ Test Patterns</div>
                                    <div class="text-xs text-gray-600 mt-1">Complete suite for advanced calibration</div>
                                </div>
                            </button>
                        </div>
                    </div> -->
                </div>
            </div>
        </div>

        <!-- Product Tabs - Compact -->
        <div class="product-tabs-container">
            <div class="product-tabs-nav">
                <nav class="product-tabs-buttons">
                    <button class="product-tab-btn tab-active" data-tab="description">
                        <span>Description</span>
                    </button>
                    <button class="product-tab-btn" data-tab="specifications">
                        <span>Specifications</span>
                    </button>
                    <button class="product-tab-btn" data-tab="documents">
                        <span>Documents</span>
                    </button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div class="product-tabs-content">
                <!-- Description Tab -->
                <div id="description-tab" class="tab-content">
                    <div class="prose prose-gray max-w-none">
                        <div class="flex items-center mb-6">
                            <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl mr-4 flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <h3 class="text-3xl font-black text-gray-800">Product Description</h3>
                        </div>
                        <div class="space-y-6">
                            <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-6 border border-purple-100">
                                <p class="text-gray-800 text-lg leading-relaxed">
                                    <!-- This will be populated by JavaScript -->
                                </p>
                            </div>
                        </div>
                        <div class="mt-8 bg-white rounded-2xl p-6 border border-gray-200 shadow-lg">
                            <h4 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                                <div class="w-8 h-8 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-lg mr-3 flex items-center justify-center">
                                    <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                Perfect For:
                            </h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- This will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Specifications Tab -->
                <div id="specifications-tab" class="tab-content hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-4">Technical Specifications</h3>
                            <table class="w-full border-collapse">
                                <!-- This will be populated by JavaScript -->
                            </table>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-4">Package Contents</h3>
                            <ul class="space-y-2 text-gray-700">
                                <!-- This will be populated by JavaScript -->
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Documents Tab -->
                <div id="documents-tab" class="tab-content hidden">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">Product Documents</h3>
                    <div id="documents-list" class="space-y-4">
                        <!-- Documents will be populated by JavaScript -->
                    </div>
                </div>

            </div>
        </div>

        <!-- Related Products -->
        <section class="product-related-section">
            <div class="product-related-header">
                <div class="product-related-title-wrapper">
                    <h2 class="product-related-title">
                        Related Products
                    </h2>
                    <!-- Decorative underline -->
                    <div class="product-related-title-underline"></div>
                    <!-- Floating accent -->
                    <div class="product-related-title-accent"></div>
                </div>
                <a href="shop.html" class="product-related-view-all">
                    <span>VIEW ALL</span>
                    <svg class="product-related-view-all-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                    </svg>
                </a>
            </div>
            <div id="related-products-grid" class="product-related-grid scrollbar-hide">
                <!-- Loading state -->
                <div class="product-related-loading">
                    <div class="product-related-loading-spinner"></div>
                    <p class="product-related-loading-text">Loading related products...</p>
                </div>
            </div>
        </section>
    </div>


    <!-- JavaScript -->

    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md mx-4">
            <!-- Login modal content will be handled by scripts.js -->
        </div>
    </div>

    <!-- Register Modal -->
    <div id="register-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md mx-4">
            <!-- Register modal content will be handled by scripts.js -->
        </div>
    </div>

    <!-- Success/Error Messages -->
    <div id="notification-container" class="fixed bottom-4 right-4 z-50"></div>

    <!-- JavaScript -->
    <script src="assets/js/config.js"></script>
    <script src="assets/js/modules/analytics-service.js"></script>
    <script src="assets/js/scripts.js"></script>
    
    <!-- Dynamic Product Loading Script -->
    <script>
        let currentProduct = null;
        let currentQuantity = 1;

        // Function to convert Google Drive URLs to direct image URLs
        function convertGoogleDriveUrl(url) {
            if (!url || !url.includes('drive.google.com')) {
                return url;
            }
            
            // Extract file ID from different Google Drive URL formats
            let fileId = null;
            
            // Format: https://drive.google.com/file/d/FILE_ID/view (with optional query params)
            if (url.includes('/file/d/')) {
                const match = url.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
                if (match) {
                    fileId = match[1];
                }
            }
            
            // Format: https://drive.google.com/open?id=FILE_ID
            if (!fileId && url.includes('open?id=')) {
                const match = url.match(/open\?id=([a-zA-Z0-9_-]+)/);
                if (match) {
                    fileId = match[1];
                }
            }
            
            // Format: https://drive.google.com/uc?id=FILE_ID
            if (!fileId && url.includes('uc?id=')) {
                const match = url.match(/uc\?id=([a-zA-Z0-9_-]+)/);
                if (match) {
                    fileId = match[1];
                }
            }
            
            if (fileId) {
                // Convert to direct image URL - use Google's thumbnail API for better reliability
                const directUrl = `https://lh3.googleusercontent.com/d/${fileId}=w1000`;
                return directUrl;
            } else {
                return url; // Return original URL as fallback instead of placeholder
            }
        }

        // Get product ID from URL parameters
        function getProductIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            // Try both 'product' and 'id' parameters for compatibility
            return urlParams.get('product') || urlParams.get('id');
        }

        // Fetch product data from API or local data
        async function fetchProduct(productId) {
            try {
                // Try API first
                const response = await fetch(`/api/products/${productId}`);
                const data = await response.json();
                
                if (data.status === 'success' && data.data && data.data.product) {
                    return data.data.product;
                } else {
                    throw new Error(data.message || 'Product not found in API response');
                }
            } catch (error) {
                // Fallback to local products array if available
                if (window.products && Array.isArray(window.products)) {
                    // First try to find by string ID
                    let localProduct = window.products.find(p => p.id === productId);
                    // If not found, try as integer
                    if (!localProduct) {
                        localProduct = window.products.find(p => p.id === parseInt(productId));
                    }
                    
                    if (localProduct) {
                        return {
                            ...localProduct,
                            inStock: true,
                            stock: localProduct.stock || 15,
                            description: localProduct.description || localProduct.shortDescription || "High-quality product from HOT IMPEX.",
                            specifications: localProduct.specifications || ["Professional grade", "High performance"],
                            images: (localProduct.images && localProduct.images.length > 0) 
                                ? localProduct.images 
                                : ["assets/images/placeholder.png"],
                            datasheet: localProduct.datasheet || null
                        };
                    }
                }

                // Default test product as last resort
                return {
                    id: productId,
                    name: "Test Product - Data Not Found",
                    category: "av-distribution",
                    price: 299.99,
                    inStock: true,
                    stock: 15,
                    description: "This is a test product displayed because the actual product data could not be loaded.",
                    specifications: ["Test specification"],
                    images: ["assets/images/placeholder.png"],
                    datasheet: null
                };
            }
        }

        // Show error message
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-4 rounded-lg shadow-lg z-50';
            errorDiv.textContent = message;
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        // Populate product data in the UI
        function populateProductData(product) {
            currentProduct = product;

            // Update title and meta
            document.title = `${product.name} - Hot Impex`;
            
            // Update breadcrumb
            document.getElementById('breadcrumb-category').textContent = product.category;
            document.getElementById('breadcrumb-product').textContent = product.name;
            
            // Update product title and badge
            document.getElementById('product-title').textContent = product.name;
            
            // Update badge based on product properties
            const badge = document.getElementById('product-badge');
            if (product.featured) {
                badge.textContent = 'Featured';
                badge.className = 'inline-block bg-purple-100 text-purple-800 text-xs font-semibold px-2 py-1 rounded-full mb-3';
            } else if (product.bestSeller) {
                badge.textContent = 'Best Seller';
                badge.className = 'inline-block bg-orange-100 text-orange-800 text-xs font-semibold px-2 py-1 rounded-full mb-3';
            } else {
                badge.textContent = 'Professional Grade';
                badge.className = 'inline-block bg-blue-100 text-blue-800 text-xs font-semibold px-2 py-1 rounded-full mb-3';
            }

            // Update price (with null checks since price section is commented out)
            const priceElement = document.getElementById('product-price');
            if (priceElement) {
                priceElement.textContent = `${product.currency} ${product.price.toLocaleString()}.00`;
            }
            
            // Handle discount (if original price exists)
            const discountSection = document.getElementById('product-discount');
            if (discountSection && product.originalPrice && product.originalPrice > product.price) {
                const discountPercent = Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100);
                const originalPriceElement = document.getElementById('original-price');
                const discountBadgeElement = document.getElementById('discount-badge');
                
                if (originalPriceElement) {
                    originalPriceElement.textContent = `${product.currency} ${product.originalPrice.toLocaleString()}.00`;
                }
                if (discountBadgeElement) {
                    discountBadgeElement.textContent = `${discountPercent}% OFF`;
                }
                discountSection.classList.remove('hidden');
            } else if (discountSection) {
                discountSection.classList.add('hidden');
            }

            // Update stock status (guard in case element is missing)
            const stockStatus = document.getElementById('stock-status');
            if (stockStatus) {
                if (product.inStock) {
                    stockStatus.innerHTML = `
                        <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                        </svg>
                        In Stock
                    `;
                    stockStatus.className = 'bg-green-100 text-green-800 text-xs font-semibold px-2 py-1 rounded-full flex items-center';
                } else {
                    stockStatus.innerHTML = `
                        <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm4.293-5.707a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        Out of Stock
                    `;
                    stockStatus.className = 'bg-red-100 text-red-800 text-xs font-semibold px-2 py-1 rounded-full flex items-center';
                }
            }

            // Update short description in "About This Product" section (with null check)
            const descriptionElement = document.getElementById('product-description');
            if (descriptionElement) {
                descriptionElement.textContent = product.shortDescription || product.description || 'No description available.';
            }
            
            // Update full description in the Description tab
            const fullDescriptionElement = document.querySelector('#description-tab .bg-gradient-to-r p');
            if (fullDescriptionElement) {
                fullDescriptionElement.textContent = product.description || product.shortDescription || 'No detailed description available.';
            }
            
            // Update "Perfect For" section in Description tab
            const perfectForGrid = document.querySelector('#description-tab .grid.grid-cols-1.md\\:grid-cols-2');
            if (perfectForGrid && product.features && product.features.length > 0) {
                perfectForGrid.innerHTML = '';
                product.features.slice(0, 6).forEach(feature => {
                    const featureItem = document.createElement('div');
                    featureItem.className = 'flex items-center space-x-3 p-3 bg-gray-50 rounded-lg';
                    featureItem.innerHTML = `
                        <div class="w-2 h-2 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-full flex-shrink-0"></div>
                        <span class="text-gray-700 text-sm font-medium">${feature}</span>
                    `;
                    perfectForGrid.appendChild(featureItem);
                });
            } else if (perfectForGrid) {
                // Default use cases if no features available
                const defaultUseCases = [
                    'Professional installations',
                    'Commercial applications',
                    'Residential setups',
                    'System integrators',
                    'AV professionals',
                    'Quality-conscious users'
                ];
                perfectForGrid.innerHTML = '';
                defaultUseCases.forEach(useCase => {
                    const featureItem = document.createElement('div');
                    featureItem.className = 'flex items-center space-x-3 p-3 bg-gray-50 rounded-lg';
                    featureItem.innerHTML = `
                        <div class="w-2 h-2 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-full flex-shrink-0"></div>
                        <span class="text-gray-700 text-sm font-medium">${useCase}</span>
                    `;
                    perfectForGrid.appendChild(featureItem);
                });
            }
            // Handle datasheet button (support both id formats and guard if missing)
            const datasheetButton = document.getElementById('datasheet-btn') || document.getElementById('datasheetButton');
            if (datasheetButton) {
                // Remove all event listeners by cloning and replacing the button
                const newButton = datasheetButton.cloneNode(true);
                datasheetButton.parentNode.replaceChild(newButton, datasheetButton);
                
                if (product.datasheet && product.datasheet.trim() !== '') {
                    let datasheetPath = product.datasheet.trim();
                    
                    // Handle Google Drive URLs for datasheets
                    if (datasheetPath.includes('drive.google.com')) {
                        datasheetPath = convertGoogleDriveUrl(datasheetPath);
                    } else if (!datasheetPath.startsWith('http://') && !datasheetPath.startsWith('https://')) {
                        // Handle local file paths
                        if (datasheetPath.startsWith('/')) {
                            datasheetPath = datasheetPath.slice(1);
                        }
                        // Path should already be correct from database
                    }
                    
                    newButton.classList.remove('hidden');
                    newButton.addEventListener('click', function datasheetClickHandler(event) {
                        event.preventDefault();
                        event.stopPropagation();
                        event.stopImmediatePropagation();
                        
                        try {
                            let finalUrl = datasheetPath;
                            
                            // For Google Drive URLs, convert to direct view link
                            if (datasheetPath.includes('drive.google.com')) {
                                finalUrl = convertGoogleDriveUrl(datasheetPath);
                            }
                            
                            // Open in new window/tab
                            const newWindow = window.open(finalUrl, '_blank');
                            
                            // Check if popup was blocked
                            if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                                // Fallback: create temporary link and click it
                                const tempLink = document.createElement('a');
                                tempLink.href = finalUrl;
                                tempLink.target = '_blank';
                                tempLink.rel = 'noopener noreferrer';
                                document.body.appendChild(tempLink);
                                tempLink.click();
                                document.body.removeChild(tempLink);
                            }
                        } catch (error) {
                            showError('Failed to open datasheet. Please try again later.');
                        }
                        
                        return false;
                    });
                } else {
                    newButton.classList.add('hidden');
                }
            }

            // Update images
            updateProductImages(product);

            // Update features
            updateProductFeatures(product);

            // Update cart button
            updateCartButton();
            
            // Populate tab content
            populateTabContent(product);
            
            // Initialize tab functionality
            initializeTabSwitching();
        }

        // Populate content for all tabs
        function populateTabContent(product) {
            // Populate Specifications Tab
            const specsTable = document.querySelector('#specifications-tab table');
            if (specsTable && product.specifications) {
                specsTable.innerHTML = '';
                Object.entries(product.specifications).forEach(([key, value]) => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-200';
                    row.innerHTML = `
                        <td class="py-3 px-4 font-semibold text-gray-800 bg-gray-50">${key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1')}</td>
                        <td class="py-3 px-4 text-gray-700">${value}</td>
                    `;
                    specsTable.appendChild(row);
                });
            }
            
            // Populate Package Contents
            const packageList = document.querySelector('#specifications-tab ul');
            if (packageList && product.packageContents && product.packageContents.length > 0) {
                packageList.innerHTML = '';
                product.packageContents.forEach(item => {
                    const listItem = document.createElement('li');
                    listItem.className = 'flex items-center space-x-2';
                    listItem.innerHTML = `
                        <svg class="w-4 h-4 text-green-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        <span>${item}</span>
                    `;
                    packageList.appendChild(listItem);
                });
            } else if (packageList) {
                // Default package contents
                const defaultContents = [
                    `1x ${product.name}`,
                    'User Manual',
                    'Warranty Card',
                    'Mounting Hardware (if applicable)'
                ];
                packageList.innerHTML = '';
                defaultContents.forEach(item => {
                    const listItem = document.createElement('li');
                    listItem.className = 'flex items-center space-x-2';
                    listItem.innerHTML = `
                        <svg class="w-4 h-4 text-green-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        <span>${item}</span>
                    `;
                    packageList.appendChild(listItem);
                });
            }
            
            // Populate Documents Tab
            const documentsList = document.getElementById('documents-list');
            if (documentsList) {
                documentsList.innerHTML = '';
                
                let hasDocuments = false;
                
                // Add datasheet if available
                if (product.datasheet && product.datasheet.trim() !== '') {
                    hasDocuments = true;
                    let datasheetPath = product.datasheet.trim();
                    
                    // Handle Google Drive URLs
                    if (datasheetPath.includes('drive.google.com')) {
                        datasheetPath = convertGoogleDriveUrl(datasheetPath);
                    } else if (!datasheetPath.startsWith('http://') && !datasheetPath.startsWith('https://')) {
                        if (datasheetPath.startsWith('/')) {
                            datasheetPath = datasheetPath.slice(1);
                        }
                    }
                    
                    const datasheetCard = document.createElement('div');
                    datasheetCard.className = 'bg-white rounded-lg p-6 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200';
                    datasheetCard.innerHTML = `
                        <div class="flex items-start justify-between">
                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0">
                                    <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                                        <svg class="w-6 h-6 text-red-600" fill="currentColor" viewBox="0 0 384 512">
                                            <path d="M181.9 256.1c-5-16-4.9-46.9-2-46.9 8.4 0 7.6 36.9 2 46.9zm-1.7 47.2c-7.7 20.2-17.3 43.3-28.4 62.7 18.3-7 39-17.2 62.9-21.9-12.7-9.6-24.9-23.4-34.5-40.8zM86.1 428.1c0 .8 13.2-5.4 34.9-40.2-6.7 6.3-29.1 24.5-34.9 40.2zM248 160h136v328c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V24C0 10.7 10.7 0 24 0h200v136c0 13.2 10.8 24 24 24zm-8 171.8c-20-12.2-33.3-29-42.7-53.8 4.5-18.5 11.6-46.6 6.2-64.2-4.7-29.4-42.4-26.5-47.8-6.8-5 18.3-.4 44.1 8.1 77-11.6 27.6-28.7 64.6-40.8 85.8-.1 0-.1.1-.2.1-27.1 13.9-73.6 44.5-54.5 68 5.6 6.9 16 10 21.5 10 17.9 0 35.7-18 61.1-61.8 25.8-8.5 54.1-19.1 79-23.2 21.7 11.8 47.1 19.5 64 19.5 29.2 0 31.2-32 19.7-43.4-13.9-13.6-54.3-9.7-73.6-7.2zM377 105L279 7c-4.5-4.5-10.6-7-17-7h-6v128h128v-6c0-6.4-2.5-12.5-7-17z"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-lg font-semibold text-gray-800 mb-1">Product Datasheet</h4>
                                    <p class="text-sm text-gray-600 mb-3">Technical specifications and detailed product information</p>
                                    <div class="flex items-center text-sm text-gray-500">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z" clip-rule="evenodd"></path>
                                        </svg>
                                        <span>PDF Document</span>
                                    </div>
                                </div>
                            </div>
                            <a href="${datasheetPath}" target="_blank" rel="noopener noreferrer" class="flex-shrink-0 inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors duration-200">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                Download
                            </a>
                        </div>
                    `;
                    documentsList.appendChild(datasheetCard);
                }
                
                // Add user manual if available
                if (product.userManual && product.userManual.trim() !== '') {
                    hasDocuments = true;
                    let manualPath = product.userManual.trim();
                    
                    // Handle Google Drive URLs
                    if (manualPath.includes('drive.google.com')) {
                        manualPath = convertGoogleDriveUrl(manualPath);
                    } else if (!manualPath.startsWith('http://') && !manualPath.startsWith('https://')) {
                        if (manualPath.startsWith('/')) {
                            manualPath = manualPath.slice(1);
                        }
                    }
                    
                    const manualCard = document.createElement('div');
                    manualCard.className = 'bg-white rounded-lg p-6 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200';
                    manualCard.innerHTML = `
                        <div class="flex items-start justify-between">
                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0">
                                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                        <svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-lg font-semibold text-gray-800 mb-1">User Manual</h4>
                                    <p class="text-sm text-gray-600 mb-3">Complete guide for installation, operation, and maintenance</p>
                                    <div class="flex items-center text-sm text-gray-500">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z" clip-rule="evenodd"></path>
                                        </svg>
                                        <span>PDF Document</span>
                                    </div>
                                </div>
                            </div>
                            <a href="${manualPath}" target="_blank" rel="noopener noreferrer" class="flex-shrink-0 inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors duration-200">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                Download
                            </a>
                        </div>
                    `;
                    documentsList.appendChild(manualCard);
                }
                
                // Add warranty certificate if available
                if (product.warranty && product.warranty.trim() !== '') {
                    hasDocuments = true;
                    let warrantyPath = product.warranty.trim();
                    
                    // Handle Google Drive URLs
                    if (warrantyPath.includes('drive.google.com')) {
                        warrantyPath = convertGoogleDriveUrl(warrantyPath);
                    } else if (!warrantyPath.startsWith('http://') && !warrantyPath.startsWith('https://')) {
                        if (warrantyPath.startsWith('/')) {
                            warrantyPath = warrantyPath.slice(1);
                        }
                    }
                    
                    const warrantyCard = document.createElement('div');
                    warrantyCard.className = 'bg-white rounded-lg p-6 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200';
                    warrantyCard.innerHTML = `
                        <div class="flex items-start justify-between">
                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0">
                                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                        <svg class="w-6 h-6 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <h4 class="text-lg font-semibold text-gray-800 mb-1">Warranty Information</h4>
                                    <p class="text-sm text-gray-600 mb-3">Product warranty details and coverage information</p>
                                    <div class="flex items-center text-sm text-gray-500">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z" clip-rule="evenodd"></path>
                                        </svg>
                                        <span>PDF Document</span>
                                    </div>
                                </div>
                            </div>
                            <a href="${warrantyPath}" target="_blank" rel="noopener noreferrer" class="flex-shrink-0 inline-flex items-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors duration-200">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                Download
                            </a>
                        </div>
                    `;
                    documentsList.appendChild(warrantyCard);
                }
                
                // Show message if no documents available
                if (!hasDocuments) {
                    documentsList.innerHTML = `
                        <div class="text-center py-12">
                            <div class="inline-flex items-center justify-center w-16 h-16 bg-gray-100 rounded-full mb-4">
                                <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                            <h4 class="text-lg font-semibold text-gray-800 mb-2">No Documents Available</h4>
                            <p class="text-gray-600">There are currently no downloadable documents for this product.</p>
                        </div>
                    `;
                }
            }
        }

        // Initialize tab switching functionality
        function initializeTabSwitching() {
            const tabButtons = document.querySelectorAll('.product-tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Remove active class from all buttons
                    tabButtons.forEach(btn => {
                        btn.classList.remove('tab-active', 'border-purple-500', 'text-purple-600');
                        btn.classList.add('border-transparent', 'text-gray-500');
                        // Remove active background
                        const activeDiv = btn.querySelector('.absolute');
                        if (activeDiv) {
                            activeDiv.classList.remove('opacity-30');
                            activeDiv.classList.add('opacity-0');
                        }
                    });
                    
                    // Add active class to clicked button
                    this.classList.add('tab-active', 'border-purple-500', 'text-purple-600');
                    this.classList.remove('border-transparent', 'text-gray-500');
                    // Add active background
                    const activeDiv = this.querySelector('.absolute');
                    if (activeDiv) {
                        activeDiv.classList.add('opacity-30');
                        activeDiv.classList.remove('opacity-0');
                    }
                    
                    // Hide all tab contents
                    tabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    // Show target tab content
                    const targetContent = document.getElementById(targetTab + '-tab');
                    if (targetContent) {
                        targetContent.classList.remove('hidden');
                    }
                });
            });
        }

        // Update product images
        function updateProductImages(product) {
            const mainImage = document.getElementById('main-image');
            const thumbnailsContainer = document.getElementById('product-thumbnails');

            // Function to validate and handle image paths
            function getValidImagePath(imagePath) {
                if (!imagePath) {
                    return 'assets/images/placeholder.svg';
                }
                
                // Handle Google Drive links
                if (imagePath.includes('drive.google.com')) {
                    let convertedUrl = convertGoogleDriveUrl(imagePath);
                    return convertedUrl;
                }
                
                // If it's already a full URL (but not Google Drive), use it as is
                if (imagePath.startsWith('http://') || imagePath.startsWith('https://')) {
                    return imagePath;
                }
                
                // If it starts with a slash, remove it to make it relative
                if (imagePath.startsWith('/')) {
                    imagePath = imagePath.slice(1);
                }
                
                // Fix common path mismatches between database and filesystem
                let correctedPath = imagePath;
                
                // Directory name corrections (database vs filesystem mismatches)
                const pathCorrections = {
                    '/Cables/': '/Cable/',
                    '/Wall Mount/': '/Cable/', // Fallback to Cable directory for missing Wall Mount
                    '/wall-mount/': '/Cable/',
                    '/Mounts/': '/Cable/',
                    '/wall mount/': '/Cable/',
                };
                
                // Apply corrections
                Object.entries(pathCorrections).forEach(([wrong, correct]) => {
                    if (correctedPath.includes(wrong)) {
                        correctedPath = correctedPath.replace(wrong, correct);
                    }
                });
                
                // If path contains non-existing directory structure, try to find the filename in existing directories
                if (correctedPath.includes('/Wall Mount/') || !correctedPath.startsWith('assets/images/Products/')) {
                    const filename = correctedPath.split('/').pop();
                    
                    // Try common directories for the filename
                    const fallbackDirs = ['Cable', 'Av distribution', 'Gaming', 'Ceiling bracket'];
                    for (const dir of fallbackDirs) {
                        const fallbackPath = `assets/images/Products/${dir}/${filename}`;
                        // We'll test this in the image loading handlers
                    }
                }
                
                return correctedPath || 'assets/images/placeholder.svg';
            }

            // Set main image - prioritize images array (Google Drive) over mainImage (local)
            let mainImagePath = null;
            
            // First try images array (usually Google Drive URLs)
            if (product.images && product.images.length > 0) {
                mainImagePath = product.images[0];
            } 
            // Fallback to mainImage field
            else if (product.mainImage) {
                mainImagePath = product.mainImage;
            }
            
            if (mainImagePath) {
                const validPath = getValidImagePath(mainImagePath);
                
                // Show loading state
                mainImage.style.opacity = '0.5';
                mainImage.alt = 'Loading...';
                
                // Create a new image element to test loading
                const testImage = new Image();
                
                // Set a timeout for image loading
                const imageTimeout = setTimeout(() => {
                    mainImage.style.opacity = '1';
                    // Try alternative if it was a Google Drive URL
                    if (validPath.includes('drive.google.com')) {
                        const fileId = validPath.match(/id=([a-zA-Z0-9_-]+)/);
                        if (fileId) {
                            const alternativeUrl = `https://lh3.googleusercontent.com/d/${fileId[1]}`;
                            testImage.src = alternativeUrl; // This will trigger the handlers again
                        }
                    }
                }, 5000); // 5 second timeout
                
                testImage.onload = function() {
                    clearTimeout(imageTimeout);
                    mainImage.src = validPath;
                    mainImage.alt = product.name;
                    mainImage.style.opacity = '1';
                };
                testImage.onerror = function() {
                    clearTimeout(imageTimeout);
                    
                    // If it was a Google Drive URL that failed, try alternative formats
                    if (validPath.includes('drive.google.com')) {
                        const fileId = validPath.match(/id=([a-zA-Z0-9_-]+)/);
                        if (fileId) {
                            const alternativeUrl = `https://lh3.googleusercontent.com/d/${fileId[1]}`;
                            
                            const altImage = new Image();
                            altImage.onload = function() {
                                mainImage.src = alternativeUrl;
                                mainImage.alt = product.name;
                            };
                            altImage.onerror = function() {
                                
                                // Try the local mainImage as final fallback
                                if (product.mainImage && product.mainImage !== mainImagePath) {
                                    const localPath = getValidImagePath(product.mainImage);
                                    const localImage = new Image();
                                    localImage.onload = function() {
                                        mainImage.src = localPath;
                                        mainImage.alt = product.name;
                                    };
                                    localImage.onerror = function() {
                                        mainImage.src = 'assets/images/placeholder.svg';
                                        mainImage.alt = 'Image not available';
                                    };
                                    localImage.src = localPath;
                                } else {
                                    mainImage.src = 'assets/images/placeholder.svg';
                                    mainImage.alt = 'Image not available';
                                }
                            };
                            altImage.src = alternativeUrl;
                            return;
                        }
                    }
                    
                    mainImage.src = 'assets/images/placeholder.svg';
                    mainImage.alt = 'Image not available';
                };
                testImage.src = validPath;
            } else {
                mainImage.src = 'assets/images/placeholder.svg';
                mainImage.alt = 'No image available';
            }

            // Create thumbnails
            thumbnailsContainer.innerHTML = '';
            const images = product.images || [];
            
            if (images.length > 0) {
                images.forEach((image, index) => {
                    const validPath = getValidImagePath(image);
                    
                    const button = document.createElement('button');
                    button.className = `thumbnail group bg-gradient-to-br from-white to-gray-50 rounded-xl shadow-lg p-4 border-2 transition-all duration-300 transform hover:scale-105 ${
                        index === 0 ? 'border-purple-500 bg-purple-50 opacity-100 active' : 'border-transparent opacity-50 hover:opacity-100'
                    } hover:border-purple-500 h-24 w-full`;
                    
                    button.onclick = () => changeImage(validPath, button);
                    
                    // Create image container div for consistent sizing
                    const imageContainer = document.createElement('div');
                    imageContainer.className = 'w-full h-16 flex items-center justify-center';
                    
                    // Create image element with error handling
                    const imgElement = document.createElement('img');
                    imgElement.src = validPath;
                    imgElement.alt = `Product view ${index + 1}`;
                    imgElement.className = 'max-w-full max-h-full object-contain group-hover:scale-110 transition-transform duration-300';
                    
                    imgElement.onerror = function() {
                        
                        // If it was a Google Drive URL that failed, try alternative formats
                        if (validPath.includes('drive.google.com')) {
                            const fileId = validPath.match(/id=([a-zA-Z0-9_-]+)/);
                            if (fileId) {
                                const alternativeUrl = `https://lh3.googleusercontent.com/d/${fileId[1]}`;
                                
                                const altImg = new Image();
                                altImg.onload = () => {
                                    this.src = alternativeUrl;
                                };
                                altImg.onerror = () => {
                                    this.src = 'assets/images/placeholder.svg';
                                    this.alt = 'Image not available';
                                };
                                altImg.src = alternativeUrl;
                                return;
                            }
                        }
                        
                        this.src = 'assets/images/placeholder.svg';
                        this.alt = 'Image not available';
                    };
                    
                    imgElement.onload = function() {
                    };
                    
                    imageContainer.appendChild(imgElement);
                    button.appendChild(imageContainer);
                    thumbnailsContainer.appendChild(button);
                });
            } else {
            }
        }

        // Update product features
        function updateProductFeatures(product) {
            const featuresContainer = document.getElementById('product-features');
            featuresContainer.innerHTML = '';

            if (product.features && product.features.length > 0) {
                product.features.forEach(feature => {
                    const featureDiv = document.createElement('div');
                    featureDiv.className = 'flex items-center space-x-2 p-2 rounded-lg hover:bg-emerald-50 transition-colors duration-200 group';
                    featureDiv.innerHTML = `
                        <svg class="w-4 h-4 text-emerald-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        <span class="text-gray-800 font-medium text-sm">${feature}</span>
                    `;
                    featuresContainer.appendChild(featureDiv);
                });
            } else {
                // Fallback features if none provided
                const defaultFeatures = ['High Quality', 'Professional Grade', 'Reliable Performance', 'Easy Installation'];
                defaultFeatures.forEach(feature => {
                    const featureDiv = document.createElement('div');
                    featureDiv.className = 'flex items-center space-x-2 p-2 rounded-lg hover:bg-emerald-50 transition-colors duration-200 group';
                    featureDiv.innerHTML = `
                        <svg class="w-4 h-4 text-emerald-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        <span class="text-gray-800 font-medium text-sm">${feature}</span>
                    `;
                    featuresContainer.appendChild(featureDiv);
                });
            }
        }

        // Image switching functionality
        window.changeImage = function(src, clickedThumbnail) {
            const mainImage = document.getElementById('main-image');
            
            // Start transition
            mainImage.style.transform = 'scale(0.95)';
            mainImage.style.opacity = '0.7';
            
            // Test the image before setting it
            const testImage = new Image();
            testImage.onload = function() {
                setTimeout(() => {
                    mainImage.src = src;
                    mainImage.style.transform = 'scale(1)';
                    mainImage.style.opacity = '1';
                }, 150);
            };
            
            testImage.onerror = function() {
                
                // If it was a Google Drive URL that failed, try alternative formats
                if (src.includes('drive.google.com')) {
                    const fileId = src.match(/id=([a-zA-Z0-9_-]+)/);
                    if (fileId) {
                        const alternativeUrl = `https://lh3.googleusercontent.com/d/${fileId[1]}`;
                        
                        const altTestImage = new Image();
                        altTestImage.onload = function() {
                            setTimeout(() => {
                                mainImage.src = alternativeUrl;
                                mainImage.style.transform = 'scale(1)';
                                mainImage.style.opacity = '1';
                            }, 150);
                        };
                        altTestImage.onerror = function() {
                            // Restore the original state
                            mainImage.style.transform = 'scale(1)';
                            mainImage.style.opacity = '1';
                            showError('Failed to load image. Please try again.');
                        };
                        altTestImage.src = alternativeUrl;
                        return;
                    }
                }
                
                // Restore the original state
                mainImage.style.transform = 'scale(1)';
                mainImage.style.opacity = '1';
                
                // Show error message
                showError('Failed to load image. Please try again.');
                return;
            };
            
            // Start loading the test image
            testImage.src = src;
            
            // Update thumbnail states
            document.querySelectorAll('.thumbnail').forEach(thumb => {
                thumb.classList.remove('border-purple-500', 'bg-purple-50', 'active', 'opacity-100');
                thumb.classList.add('border-transparent', 'opacity-50');
            });
            
            // Highlight clicked thumbnail
            if (clickedThumbnail) {
                clickedThumbnail.classList.remove('border-transparent', 'opacity-50');
                clickedThumbnail.classList.add('border-purple-500', 'bg-purple-50', 'active', 'opacity-100');
            }
        };

        // Update cart button with current price
        function updateCartButton() {
            if (!currentProduct) return;
            
            const totalPrice = currentProduct.price * currentQuantity;
            const cartButtons = document.querySelectorAll('button');
            cartButtons.forEach(button => {
                if (button.textContent.includes('Add to Cart')) {
                    const span = button.querySelector('span');
                    if (span) {
                        span.textContent = `Add to Cart - ${currentProduct.currency} ${totalPrice.toLocaleString()}.00`;
                    }
                }
            });
        }

        // Load and display related products
        async function loadRelatedProducts(currentProduct) {
            
            try {
                // Try API first
                const response = await fetch('/api/products');
                let allProducts = [];
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.status === 'success') {
                        allProducts = data.data.products;
                    }
                } else {
                    // Fallback to local products data
                    if (window.products && Array.isArray(window.products)) {
                        allProducts = window.products;
                    }
                }

                if (allProducts.length === 0) {
                    return;
                }

                // Filter related products
                let relatedProducts = getRelatedProducts(currentProduct, allProducts);
                
                // Display related products
                displayRelatedProducts(relatedProducts);
                
            } catch (error) {
                // Hide loading state and show error or empty message
                const grid = document.getElementById('related-products-grid');
                if (grid) {
                    grid.innerHTML = '<div class="col-span-full text-center py-8"><p class="text-gray-600">Unable to load related products</p></div>';
                }
            }
        }

        // Get related products based on current product
        function getRelatedProducts(currentProduct, allProducts) {
            const maxRelatedProducts = 4;
            let relatedProducts = [];

            // First, try to get products from the same category
            const sameCategory = allProducts.filter(product => 
                product.id !== currentProduct.id && 
                (product.category === currentProduct.category || 
                 product.categorySlug === currentProduct.categorySlug ||
                 product.categorySlug === currentProduct.category)
            );

            // Add products from same category first
            relatedProducts = [...sameCategory.slice(0, maxRelatedProducts)];

            // If we need more products, add random products from other categories
            if (relatedProducts.length < maxRelatedProducts) {
                const otherProducts = allProducts.filter(product => 
                    product.id !== currentProduct.id && 
                    !relatedProducts.some(rp => rp.id === product.id)
                );
                
                // Shuffle and add remaining products
                const shuffled = otherProducts.sort(() => 0.5 - Math.random());
                const needed = maxRelatedProducts - relatedProducts.length;
                relatedProducts = [...relatedProducts, ...shuffled.slice(0, needed)];
            }

            return relatedProducts.slice(0, maxRelatedProducts);
        }

        // Create a product card for related products using the same style as shop
        function createRelatedProductCard(product) {
            const productPrice = parseFloat(product.price) || 0;
            const originalPrice = product.originalPrice ? parseFloat(product.originalPrice) : null;
            const currency = product.currency || 'EGP';
            const isOnSale = originalPrice && originalPrice > productPrice;
            
            // Handle image URL using the same logic as main product
            let imageUrl = null;
            
            // Prioritize images array (Google Drive) over mainImage (local)
            if (product.images && product.images.length > 0) {
                imageUrl = product.images[0];
            }
            // Fallback to mainImage field
            else if (product.mainImage) {
                imageUrl = product.mainImage;
            }
            // Fallback to image field
            else if (product.image) {
                imageUrl = product.image;
            }
            
            // Use the same validation logic as main product images
            if (imageUrl) {
                imageUrl = getValidImagePath(imageUrl);
            } else {
                imageUrl = 'assets/images/placeholder.svg';
            }

            // Determine the gradient colors based on product index or category
            const gradients = [
                { bg: 'from-purple-50 to-pink-50', accent: 'from-purple-200 to-pink-200', text: 'text-purple-600', button: 'from-purple-500 to-pink-500' },
                { bg: 'from-emerald-50 to-teal-50', accent: 'from-emerald-200 to-teal-200', text: 'text-emerald-600', button: 'from-emerald-500 to-teal-500' },
                { bg: 'from-blue-50 to-cyan-50', accent: 'from-blue-200 to-cyan-200', text: 'text-blue-600', button: 'from-blue-500 to-cyan-500' },
                { bg: 'from-orange-50 to-red-50', accent: 'from-orange-200 to-red-200', text: 'text-orange-600', button: 'from-orange-500 to-red-500' }
            ];
            
            // Use a hash of product ID to consistently assign colors
            const colorIndex = Math.abs(product.id.toString().split('').reduce((a, b) => (a << 5) - a + b.charCodeAt(0), 0)) % gradients.length;
            const gradient = gradients[colorIndex];

            // Card styling
            const cardClasses = `group bg-gradient-to-br from-white to-gray-50 rounded-2xl sm:rounded-3xl shadow-lg overflow-hidden hover:shadow-2xl transition-all duration-500 transform hover:scale-105 border border-gray-200 flex-shrink-0 w-64 sm:w-full sm:min-w-[280px]`;
            const imageClasses = `max-w-full max-h-full object-contain rounded-lg group-hover:scale-110 transition-transform duration-500`;

            return `
                <a href="product.html?product=${product.id}" class="${cardClasses}">
                    <div class="relative bg-gradient-to-br ${gradient.bg} p-4 sm:p-6 h-48 sm:h-64 flex items-center justify-center">
                        <div class="absolute top-0 right-0 w-12 h-12 sm:w-16 sm:h-16 bg-gradient-to-br ${gradient.accent} rounded-full opacity-30 transform translate-x-6 sm:translate-x-8 -translate-y-6 sm:-translate-y-8 group-hover:scale-125 transition-transform duration-500"></div>
                        <div class="w-full h-full flex items-center justify-center relative z-10">
                            <img src="${imageUrl}" 
                                 alt="${product.name}" 
                                 class="${imageClasses} max-w-[70%] sm:max-w-[80%] max-h-[70%] sm:max-h-[80%]"
                                 onerror="handleImageError(this, '${product.mainImage || ''}')">
                        </div>
                        <div class="absolute inset-0 bg-gradient-to-t from-gray-600/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                        
                        <!-- Product badges -->
                        ${product.featured ? '<span class="absolute top-2 left-2 sm:top-3 sm:left-3 bg-blue-500 text-white text-xs font-bold px-2 py-1 rounded-full z-50">FEATURED</span>' : ''}
                        ${product.bestSeller ? '<span class="absolute top-2 left-2 sm:top-3 sm:left-3 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-full z-50">BEST SELLER</span>' : ''}
                        ${isOnSale ? '<span class="absolute top-2 left-2 sm:top-3 sm:left-3 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full z-50">SALE</span>' : ''}
                    </div>
                    <div class="p-3 sm:p-4">
                        <h3 class="font-bold text-gray-800 text-base sm:text-lg mb-2 group-hover:${gradient.text} transition-colors duration-300 line-clamp-2" title="${product.name}">${product.name}</h3>
                        <p class="text-gray-600 text-xs sm:text-sm mb-2 sm:mb-3 capitalize">${product.category || 'Product'}</p>
                        
                        <div class="flex items-center space-x-1 sm:space-x-2">
                            <svg class="w-3 h-3 sm:w-4 sm:h-4 ${gradient.text}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                            </svg>
                            <span class="text-xs sm:text-sm font-medium ${gradient.text} group-hover:translate-x-1 transition-transform duration-300">View Details</span>
                        </div>
                    </div>
                </a>
            `;
        }

        // Handle image loading errors with fallback options
        function handleImageError(img, fallbackUrl) {
            // First try the mainImage fallback if provided
            if (fallbackUrl && fallbackUrl !== img.src && !img.dataset.tried_fallback) {
                img.dataset.tried_fallback = 'true';
                img.src = getValidImagePath(fallbackUrl);
                return;
            }
            
            // Final fallback to placeholder
            img.src = 'assets/images/placeholder.svg';
        }

        // Display related products
        function displayRelatedProducts(relatedProducts) {
            const grid = document.getElementById('related-products-grid');
            if (!grid) {
                return;
            }

            if (relatedProducts.length === 0) {
                grid.innerHTML = '<div class="flex-shrink-0 w-full sm:col-span-full text-center py-8"><p class="text-gray-600">No related products found</p></div>';
                return;
            }

            // Generate HTML for all related products
            const productsHTML = relatedProducts.map(product => createRelatedProductCard(product)).join('');
            
            // Update the grid
            grid.innerHTML = productsHTML;
            
        }

        // Initialize product page
        document.addEventListener('DOMContentLoaded', async function() {
            
            // Wait for other scripts to load
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Check if required global objects exist
            if (typeof API_CONFIG === 'undefined') {
                return;
            }
            
            if (typeof APIService === 'undefined') {
                return;
            }
            
            
            // Check if dropdown elements exist
            const userDropdownToggle = document.getElementById('user-dropdown-toggle');
            const userDropdownMenu = document.getElementById('user-dropdown-menu');
            const cartToggle = document.getElementById('cart-toggle');
            const cartSidebar = document.getElementById('cart-sidebar');
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const mobileMenu = document.getElementById('mobile-menu');
            
            
            // Get product ID from URL
            const productId = getProductIdFromUrl();
            
            if (!productId) {
                showError('No product specified in URL');
                setTimeout(() => {
                    window.location.href = 'shop.html';
                }, 3000);
                return;
            }

            // Fetch and display product
            const product = await fetchProduct(productId);
            if (product) {
                populateProductData(product);
                
                // Track product visit for analytics
                if (typeof AnalyticsService !== 'undefined') {
                    AnalyticsService.trackProductVisit(productId, product.name);
                    console.log(`📊 Tracked direct visit to product page: ${product.name}`);
                }
                
                // Load related products
                loadRelatedProducts(product);
                
                // Set up quantity controls after product is loaded
                const qtyMinusTop = document.getElementById('qty-minus-top');
                const qtyPlusTop = document.getElementById('qty-plus-top');
                const quantityTop = document.getElementById('quantity-top');
                
                // Decrease quantity
                qtyMinusTop.addEventListener('click', function() {
                    if (currentQuantity > 1) {
                        currentQuantity--;
                        quantityTop.textContent = currentQuantity;
                        updateCartButton();
                    }
                });
                
                // Increase quantity
                qtyPlusTop.addEventListener('click', function() {
                    if (currentQuantity < 99) {
                        currentQuantity++;
                        quantityTop.textContent = currentQuantity;
                        updateCartButton();
                    }
                });

                // Use unified cart system from scripts.js
                const addToCartBtn = document.getElementById('add-to-cart-btn');
                if (addToCartBtn) {
                    addToCartBtn.addEventListener('click', function() {
                        
                        if (!currentProduct) {
                            showError('Product not loaded. Please refresh the page.');
                            return;
                        }
                        
                        if (typeof window.addToCart === 'function') {
                            try {
                                // Use the global addToCart function
                                window.addToCart(currentProduct.id, currentQuantity);
                            } catch (error) {
                                showError('Failed to add product to cart. Please try again.');
                            }
                        } else {
                            showError('Cart system not ready. Please refresh the page.');
                        }
                    });
                } else {
                }

                // Function to show success message
                function showSuccessMessage(message) {
                    const successDiv = document.createElement('div');
                    successDiv.className = 'fixed top-20 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300';
                    successDiv.innerHTML = `
                        <div class="flex items-center space-x-2">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                            <span>${message}</span>
                        </div>
                    `;
                    document.body.appendChild(successDiv);
                    
                    // Animate in
                    setTimeout(() => {
                        successDiv.classList.remove('translate-x-full');
                    }, 100);
                    
                    // Remove after 3 seconds
                    setTimeout(() => {
                        successDiv.classList.add('translate-x-full');
                        setTimeout(() => {
                            successDiv.remove();
                        }, 300);
                    }, 3000);
                }

                // Use global updateCartUI function from scripts.js
                // This ensures consistent cart display across all pages

                // Use global cart functions instead of local removeFromCart
                // The global removeFromCart is already available

                // Cart functionality is handled by global scripts.js
                // No need to set up event listeners here as they're already handled globally

            // Initialize cart display using global function
            if (window.updateCartUI) {
                window.updateCartUI();
            } else {
            }

            // Reinitialize cart event listeners for this page
            setTimeout(() => {
                try {
                    if (typeof window.reinitializeCartEventListeners === 'function') {
                        window.reinitializeCartEventListeners();
                    } else {
                    }
                } catch (error) {
                }
                
                // Verify cart functionality
                const cartToggle = document.getElementById('cart-toggle');
                const desktopCartToggle = document.getElementById('desktop-cart-toggle');
                const cartSidebar = document.getElementById('cart-sidebar');
                const cartOverlay = document.getElementById('cart-overlay');
                
                
                // List available cart-related functions
                const cartFunctions = Object.keys(window).filter(key => 
                    typeof window[key] === 'function' && 
                    (key.toLowerCase().includes('cart') || key.toLowerCase().includes('toggle'))
                );
                
                // Test the cart functionality
                if (typeof window.toggleCart === 'function') {
                } else {
                }
            }, 1000); // Increased timeout to ensure scripts are fully loaded

            } else {
                showError('Product not found. Redirecting to shop...');
                // Redirect to shop if product not found
                setTimeout(() => {
                    window.location.href = 'shop.html';
                }, 3000);
                return;
            }
        });
    </script>
</body>
</html>
