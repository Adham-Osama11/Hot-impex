<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clear Storage - Hot Impex</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
    <div class="bg-white p-8 rounded-lg shadow-md max-w-md w-full">
        <h1 class="text-2xl font-bold mb-6 text-center">Clear Storage & Debug</h1>
        
        <div class="space-y-4">
            <button id="clearStorage" class="w-full bg-red-500 text-white py-2 px-4 rounded hover:bg-red-600">
                Clear All localStorage
            </button>
            
            <button id="showStorage" class="w-full bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600">
                Show Current Storage
            </button>
            
            <button id="testLogin" class="w-full bg-green-500 text-white py-2 px-4 rounded hover:bg-green-600">
                Test Login API Directly
            </button>
            
            <div class="mt-4">
                <label class="block text-sm font-medium mb-2">Email:</label>
                <input type="email" id="email" value="test@gmail.com" class="w-full p-2 border rounded">
                
                <label class="block text-sm font-medium mb-2 mt-2">Password:</label>
                <input type="password" id="password" value="123456" class="w-full p-2 border rounded">
            </div>
        </div>
        
        <div id="output" class="mt-6 p-4 bg-gray-100 rounded text-sm font-mono whitespace-pre-wrap max-h-64 overflow-y-auto"></div>
        
        <div class="mt-4 text-center">
            <a href="index.html" class="text-blue-500 hover:underline">← Back to Home</a>
        </div>
    </div>

    <script>
        const API_BASE_URL = window.location.origin + '/api';
        const output = document.getElementById('output');

        function log(message) {
            console.log(message);
            output.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            output.scrollTop = output.scrollHeight;
        }

        document.getElementById('clearStorage').addEventListener('click', () => {
            localStorage.clear();
            log('✅ localStorage cleared completely');
            log('Current localStorage length: ' + localStorage.length);
        });

        document.getElementById('showStorage').addEventListener('click', () => {
            log('=== CURRENT LOCALSTORAGE ===');
            log('Length: ' + localStorage.length);
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                log(`${key}: ${value}`);
            }
            
            log('=== SPECIFIC KEYS ===');
            log('hotimpex-token: ' + localStorage.getItem('hotimpex-token'));
            log('hotimpex-user: ' + localStorage.getItem('hotimpex-user'));
        });

        document.getElementById('testLogin').addEventListener('click', async () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            log('=== TESTING LOGIN API ===');
            log('Email: ' + email);
            log('Password: ' + password);
            
            try {
                const response = await fetch(`${API_BASE_URL}/users/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                log('Response status: ' + response.status);
                log('Response ok: ' + response.ok);
                
                const data = await response.json();
                log('Response data:');
                log(JSON.stringify(data, null, 2));
                
                if (data.status === 'success' && data.data && data.data.token) {
                    log('✅ Token found in response: ' + data.data.token.substring(0, 50) + '...');
                    
                    // Test storing the token
                    localStorage.setItem('hotimpex-token', data.data.token);
                    localStorage.setItem('hotimpex-user', JSON.stringify(data.data.user));
                    
                    log('✅ Token and user stored in localStorage');
                    
                    // Test profile API with the token
                    log('=== TESTING PROFILE API ===');
                    const profileResponse = await fetch(`${API_BASE_URL}/users/profile`, {
                        headers: {
                            'Authorization': `Bearer ${data.data.token}`
                        }
                    });
                    
                    log('Profile response status: ' + profileResponse.status);
                    const profileData = await profileResponse.json();
                    log('Profile response:');
                    log(JSON.stringify(profileData, null, 2));
                    
                } else {
                    log('❌ No token in login response');
                }
                
            } catch (error) {
                log('❌ Error: ' + error.message);
                console.error(error);
            }
        });

        // Initial storage check
        document.addEventListener('DOMContentLoaded', () => {
            log('Page loaded. Current localStorage:');
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                log(`${key}: ${value.substring(0, 50)}${value.length > 50 ? '...' : ''}`);
            }
        });
    </script>
</body>
</html>
